<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="悟已往之不谏，知来者之可追。">
<meta property="og:type" content="website">
<meta property="og:title" content="Cainiao&#39;s Home">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Cainiao&#39;s Home">
<meta property="og:description" content="悟已往之不谏，知来者之可追。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cainiao&#39;s Home">
<meta name="twitter:description" content="悟已往之不谏，知来者之可追。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Cainiao's Home</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-97248239-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?afd04594fdb55f6d7dbb7128c915b991";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Cainiao's Home</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/Codeforces-796D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/Codeforces-796D/" itemprop="url">Codeforces 796D</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T23:02:36+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给一颗树，$N$个点，$N-1$条边。有$K$个警察局，第$i$个警察局在点$p_i$上。</p>
<p>性质$P$定义为：对任意点$v$，存在警察局$u$，使得$dist(u,v)\leq D$ 。</p>
<p>初始的图满足性质$P$。</p>
<p>问：最多删除哪些边使得图仍然满足性质$P$。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$2\leq N \leq 3\times 10^5\quad 1 \leq K \leq 3 \times 10^5 \quad 0\leq D \leq N-1$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>先考虑最多能删除多少边。在树上，每删除一条边，就多一个连通块。为了满足性质$P$，显然最多只能有$K_{real}$个连通块。其中，$K_{real}$为其上有警察局的节点的个数。这点容易反证得出。由此，我们得出了删除的边数的一个上界是$K_{real}−1$ 。</p>
<p>现在考虑如何删。由于初始图满足性质$P$，所以每个点到距其最近的警察局的距离$\leq D$。于是，我们只要保证每个点能够到达距其最近的警察局即可，其余的边都删掉。这样，我们便将树分成了$K_{real}$个连通块，也即删去了$K_{real}-1$条边。</p>
<p>所以，最多删去$K_{real}-1$条边，删除方法如上所述，可用$BFS$实现。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; pii;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">3e5</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">int</span> N, K, D;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAX_N];</div><div class="line"><span class="keyword">bool</span> p[MAX_N];</div><div class="line"><span class="built_in">map</span>&lt;pii, <span class="keyword">int</span>&gt; edge_id;</div><div class="line"><span class="keyword">bool</span> vis[MAX_N];</div><div class="line"><span class="keyword">bool</span> edge_del[MAX_N];</div><div class="line"><span class="keyword">int</span> d[MAX_N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></div><div class="line">&#123;</div><div class="line">  G[a].push_back(b);</div><div class="line">  G[b].push_back(a);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Bfs</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (p[i]) &#123;</div><div class="line">      que.push(i);</div><div class="line">      vis[i] = <span class="number">1</span>;</div><div class="line">      d[i] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">    <span class="keyword">int</span> v = que.front(); que.pop();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[v].size(); ++i) &#123;</div><div class="line">      <span class="keyword">int</span> u = G[v][i];</div><div class="line">      <span class="keyword">if</span> (!vis[u]) &#123;</div><div class="line">        que.push(u);</div><div class="line">        vis[u] = <span class="number">1</span>;</div><div class="line">        d[u] = d[v] + <span class="number">1</span>;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (d[u] &gt;= d[v]) &#123;</div><div class="line">          <span class="keyword">int</span> v1 = min(u, v), v2 = max(u, v);</div><div class="line">          edge_del[edge_id[pii(v1, v2)]] = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">cin</span> &gt;&gt; N &gt;&gt; K &gt;&gt; D;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; ++i) &#123;</div><div class="line">    <span class="keyword">int</span> tmp; <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;tmp);</div><div class="line">    p[--tmp] = <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">int</span> a, b; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b); --a; --b;</div><div class="line">    AddEdge(a, b);</div><div class="line">    <span class="keyword">if</span> (a &gt; b) swap(a, b);</div><div class="line">    edge_id[pii(a, b)] = i;</div><div class="line">  &#125;</div><div class="line">  Bfs();</div><div class="line">  <span class="keyword">int</span> edge_del_num = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (edge_del[i]) ++edge_del_num;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, edge_del_num);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (edge_del[i]) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, i, --edge_del_num ? <span class="string">' '</span> : <span class="string">'\n'</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><ol>
<li><p>对删除的边计数的时候，注意去重。</p>
</li>
<li><p>开始我的做法不是对有警察局的点一起$BFS$，而是对这些点一个一个$BFS$。但是这样会造成删边之后有些点不能到达警察局。不满足性质$P$。</p>
<p>比如下图，$1$和$5$有警察局，$D=2$。如果从$1$开始$BFS$，那么会造成搜不到$4$的情况。<img src="http://imglf.nosdn.127.net/img/b0pmUXJIb2RvdXEwVUVMTFp3Sm1LNlR1cytRZ04wQTZYQ0JlYXo5Nnh0M0VRejBBVFQvVzB3PT0.png?imageView&amp;thumbnail=500x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt="img"></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/Codeforces-796C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/Codeforces-796C/" itemprop="url">Codeforces 796C</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T22:49:56+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给一颗$N$个节点的树，节点$i$有权值$a_i$。第一次可以随意删除一个节点i，费用为$a_i$，并且与$a_i$距离为$1$的节点$j$的权值$$a_j增加$1$,与$i$距离为$2$的节点$K$的权值$$a_k增加$2$。之后删除的点必须与某个已被删除的点距离为$1$，其余删除规则与第一次一样。问：删除所有的点，费用的最大值的最小值是多少？</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$1 \leq N \leq 3 \times 10^5 \quad |a_i| \leq 10^9$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><h2 id="O-N-times-log-2N"><a href="#O-N-times-log-2N" class="headerlink" title="$O(N\times log_2N)$"></a>$O(N\times log_2N)$</h2><p>第一个被删除的点$i$的费用是$a_i$，与$i$相连的点$j$的费用是$a_j+1$，其余的点$k$的费用都是$a_k+2$（由树上无环的性质和删除的规则可以推出）。于是，我们只要枚举第一个删除的点，模拟一下删除的过程即可，需要一个数据结构来支持高效地插入、删除和查询最大值的操作，<code>multiset</code>可以满足要求。</p>
<h2 id="O-N"><a href="#O-N" class="headerlink" title="$O(N)$"></a>$O(N)$</h2><p>上文已分析出：每个点的权值最多增加$2$。所以答案只能是$m,m+1,m+2$中的数。其中，$m$为初始权值的最大值。所以，我们在枚举第一个删除的点后模拟删除的过程中，只要记录剩余的集合中$m-1$的个数和$m$的个数即可。</p>
<p><em>注意：删除与第一个删除的数相连的数时，如果它是m-1,那么权值的最大值至少是m+1。我们可以等价地处理成在删掉第一个数和所有与第一个数相连的数的集合中加入数m-1。</em></p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="O-N-times-log-2N-1"><a href="#O-N-times-log-2N-1" class="headerlink" title="$O(N\times log_2N)$"></a>$O(N\times log_2N)$</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">3e5</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">int</span> N, a[MAX_N];</div><div class="line"><span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; S;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAX_N];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">cin</span> &gt;&gt; N;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, a + i), S.insert(a[i]);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">int</span> a, b; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b); --a; --b;</div><div class="line">    G[a].push_back(b);</div><div class="line">    G[b].push_back(a);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">int</span> ans = INT_MAX;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">0</span>; v &lt; N; ++v) &#123;</div><div class="line">    <span class="keyword">int</span> tmp_ans = a[v];</div><div class="line">    S.erase(S.find(a[v]));</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u : G[v]) &#123;</div><div class="line">      <span class="keyword">if</span> (u != v) &#123;</div><div class="line">        S.erase(S.find(a[u]));</div><div class="line">        tmp_ans = max(tmp_ans, a[u] + <span class="number">1</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!S.empty()) tmp_ans = max(tmp_ans, *S.rbegin() + <span class="number">2</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u : G[v]) &#123;</div><div class="line">      <span class="keyword">if</span> (u != v) &#123;</div><div class="line">        S.insert(a[u]);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    S.insert(a[v]);</div><div class="line">    ans = min(ans, tmp_ans);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="O-N-1"><a href="#O-N-1" class="headerlink" title="$O(N)$"></a>$O(N)$</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">3e5</span> + <span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N;</div><div class="line"><span class="keyword">int</span> a[MAX_N];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAX_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">cin</span> &gt;&gt; N;</div><div class="line">  <span class="keyword">int</span> max_num = INT_MIN;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, a + i), max_num = max(max_num, a[i]);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">int</span> a, b; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b); --a; --b;</div><div class="line">    G[a].push_back(b);</div><div class="line">    G[b].push_back(a);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (a[i] == max_num) x++;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (a[i] == max_num - <span class="number">1</span>) y++;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">int</span> ans = max_num + <span class="number">2</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">int</span> nx = x, ny = y;</div><div class="line">    <span class="keyword">if</span> (a[i] == max_num) --nx;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (a[i] == max_num - <span class="number">1</span>) --ny;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> u : G[i]) <span class="keyword">if</span> (u != i) &#123;</div><div class="line">      <span class="keyword">if</span> (a[u] == max_num) --nx, ++ny;</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (a[u] == max_num - <span class="number">1</span>) --ny;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (nx == <span class="number">0</span>) &#123;</div><div class="line">      ans = min(ans, max_num + <span class="number">1</span>);</div><div class="line">      <span class="keyword">if</span> (ny == <span class="number">0</span>) ans = min(ans, max_num);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/Codeforces-796F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/Codeforces-796F/" itemprop="url">Codeforces 796F</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T22:34:39+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>有一个长度为N的数列，每个数不超过$10^9$，顺序给出$M$个操作以及对应操作的结果。要求还原出那个数列，若有多个数列满足条件，输出每个数按位或的值最大的那个数列。原数列可能不存在。</p>
<p>操作有2种：<br>第一种：$l,r,x$。代表原数列下标在$[l,r]$范围内的最大的数为$x$。题目保证每个$x$都不相同。<br>第二种：$k,d$。代表将原数列中第$k$个数改为$d$。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$1 \leq N, M, \leq 3 \times 10^5 \quad 0 \leq x \leq 10^9$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>对于此题，我们似乎做不了别的，只能求出满足条件的原数列中的每个数的最大值。（这可以用线段树在$O(M\times log_2N)O(M\times log_2N)$的时间内求出。）</p>
<p>将此数列当作原数列，对其进行$M$个操作。我们发现，若第$i$次操作的结果比所给结果小，那么原数列不存在，因为原数列中的数已经不可能更大了。若操作结果比所给结果大，那么原数列也不存在（此时是操作之间有矛盾）。</p>
<p>现在只要最大化此数列的或的结果。</p>
<p>若有大于等于$2$个自由（不被操作1所约束）的数，那么令一个等于$2^{29}$，另一个等于$2^{29}-1$，那么或的结果就最大了。</p>
<p>若自由数的个数小于$2$。先不考虑自由的数。对于每个至少出现$2$次的数，我们将其一个减少，方法为：将其二进制表示下的最左边的$2$反转，右边全变为$1$。如果有自由数的话，再贪心地将其二进制高位置$1$，并保证不超过$10^9$。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">3e5</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">3e5</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> N, M;</div><div class="line"><span class="keyword">int</span> T[MAX_M], L[MAX_M], R[MAX_M], X[MAX_M], K[MAX_M], D[MAX_M];</div><div class="line"><span class="keyword">int</span> max_num[MAX_N];</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; max_num_occur;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> dat[MAX_N &lt;&lt; <span class="number">2</span>];</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="built_in">memset</span>(dat, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dat);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (b &lt;= l || r &lt;= a) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span> (a &lt;= l &amp;&amp; r &lt;= b) &#123;</div><div class="line">      dat[k] = min(dat[k], c);</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (dat[k] != INF) &#123;</div><div class="line">      dat[<span class="number">2</span> * k + <span class="number">1</span>] = min(dat[<span class="number">2</span> * k + <span class="number">1</span>], dat[k]);</div><div class="line">      dat[<span class="number">2</span> * k + <span class="number">2</span>] = min(dat[<span class="number">2</span> * k + <span class="number">2</span>], dat[k]);</div><div class="line">      dat[k] = INF;</div><div class="line">    &#125;</div><div class="line">    update(a, b, c, l, (l + r) / <span class="number">2</span>, <span class="number">2</span> * k + <span class="number">1</span>);</div><div class="line">    update(a, b, c, (l + r) / <span class="number">2</span>, r, <span class="number">2</span> * k + <span class="number">2</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (r - l == <span class="number">1</span>) <span class="keyword">return</span> dat[k];</div><div class="line">    <span class="keyword">if</span> (dat[k] != INF) &#123;</div><div class="line">      dat[<span class="number">2</span> * k + <span class="number">1</span>] = min(dat[<span class="number">2</span> * k + <span class="number">1</span>], dat[k]);</div><div class="line">      dat[<span class="number">2</span> * k + <span class="number">2</span>] = min(dat[<span class="number">2</span> * k + <span class="number">2</span>], dat[k]);</div><div class="line">      dat[k] = INF;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> mid = (l + r) / <span class="number">2</span>;</div><div class="line">    <span class="keyword">if</span> (x &lt; mid) <span class="keyword">return</span> query(x, l, (l + r) / <span class="number">2</span>, <span class="number">2</span> * k + <span class="number">1</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> query(x, (l + r) / <span class="number">2</span>, r, <span class="number">2</span> * k + <span class="number">2</span>);</div><div class="line">  &#125;</div><div class="line">&#125; st1;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree2</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> dat[MAX_N &lt;&lt; <span class="number">2</span>];</div><div class="line">  <span class="keyword">int</span> *src;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (r - l == <span class="number">1</span>) &#123;</div><div class="line">      dat[k] = src[l];</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    build(l, (l + r) / <span class="number">2</span>, <span class="number">2</span> * k + <span class="number">1</span>);</div><div class="line">    build((l + r) / <span class="number">2</span>, r, <span class="number">2</span> * k + <span class="number">2</span>);</div><div class="line">    dat[k] = max(dat[<span class="number">2</span> * k + <span class="number">1</span>], dat[<span class="number">2</span> * k + <span class="number">2</span>]);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (r - l == <span class="number">1</span>) &#123;</div><div class="line">      dat[k] = v;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> mid = (l + r) / <span class="number">2</span>;</div><div class="line">    <span class="keyword">if</span> (x &lt; mid) update(x, v, l, (l + r) / <span class="number">2</span>, <span class="number">2</span> * k + <span class="number">1</span>);</div><div class="line">    <span class="keyword">else</span> update(x, v, (l + r) / <span class="number">2</span>, r, <span class="number">2</span> * k + <span class="number">2</span>);</div><div class="line">    dat[k] = max(dat[<span class="number">2</span> * k + <span class="number">1</span>], dat[<span class="number">2</span> * k + <span class="number">2</span>]);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (b &lt;= l || r &lt;= a) <span class="keyword">return</span> INT_MIN;</div><div class="line">    <span class="keyword">if</span> (a &lt;= l &amp;&amp; r &lt;= b) &#123;</div><div class="line">      <span class="keyword">return</span> dat[k];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> vl = query(a, b, l, (l + r) / <span class="number">2</span>, <span class="number">2</span> * k + <span class="number">1</span>);</div><div class="line">    <span class="keyword">int</span> vr = query(a, b, (l + r) / <span class="number">2</span>, r, <span class="number">2</span> * k + <span class="number">2</span>);</div><div class="line">    <span class="keyword">return</span> max(vl, vr);</div><div class="line">  &#125;</div><div class="line">&#125; st2;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">cin</span> &gt;&gt; N &gt;&gt; M;</div><div class="line">  <span class="built_in">memset</span>(max_num, <span class="number">-1</span>, <span class="keyword">sizeof</span> max_num);</div><div class="line">  st1.build();</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; ++i) &#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T[i]);</div><div class="line">    <span class="keyword">if</span> (T[i] == <span class="number">1</span>) &#123;</div><div class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;L[i], &amp;R[i], &amp;X[i]); --L[i];</div><div class="line">      st1.update(L[i], R[i], X[i], <span class="number">0</span>, N, <span class="number">0</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;K[i], &amp;D[i]); --K[i];</div><div class="line">      <span class="keyword">if</span> (max_num[K[i]] == <span class="number">-1</span>) &#123;</div><div class="line">        max_num[K[i]] = st1.query(K[i], <span class="number">0</span>, N, <span class="number">0</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (max_num[i] == <span class="number">-1</span>) &#123;</div><div class="line">      max_num[i] = st1.query(i, <span class="number">0</span>, N, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  st2.src = max_num;</div><div class="line">  st2.build(<span class="number">0</span>, N, <span class="number">0</span>);</div><div class="line">  <span class="keyword">bool</span> exist_ans = <span class="literal">true</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (T[i] == <span class="number">1</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (st2.query(L[i], R[i], <span class="number">0</span>, N, <span class="number">0</span>) != X[i]) &#123;</div><div class="line">        exist_ans = <span class="number">0</span>;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      st2.update(K[i], D[i], <span class="number">0</span>, N, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (!exist_ans) &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"NO\n"</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"YES\n"</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">      max_num_occur[max_num[i]]++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (max_num_occur[INF] &gt;= <span class="number">2</span>) &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (max_num[i] == INF) &#123;</div><div class="line">          max_num[i] = (<span class="number">1</span> &lt;&lt; <span class="number">29</span>);</div><div class="line">          <span class="keyword">if</span> (--max_num_occur[INF] == <span class="number">0</span>) &#123;</div><div class="line">            max_num[i] = (<span class="number">1</span> &lt;&lt; <span class="number">29</span>) - <span class="number">1</span>;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, max_num[i]);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (max_num[i] == <span class="number">0</span> || max_num[i] == INF) <span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">if</span> (--max_num_occur[max_num[i]] &gt; <span class="number">0</span>) &#123;</div><div class="line">          <span class="keyword">int</span> log2x = <span class="number">31</span> - __builtin_clz(max_num[i]);</div><div class="line">          max_num[i] = (<span class="number">1</span> &lt;&lt; log2x) - <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        res |= max_num[i];</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">int</span> free_num = <span class="number">0</span>;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">29</span>; i &gt;= <span class="number">0</span>; --i) &#123;</div><div class="line">        <span class="keyword">if</span> (res &gt;&gt; i &amp; <span class="number">1</span>) <span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">if</span> (free_num + (<span class="number">1</span> &lt;&lt; i) &gt; (<span class="keyword">int</span>)(<span class="number">1e9</span>)) <span class="keyword">continue</span>;</div><div class="line">        free_num |= (<span class="number">1</span> &lt;&lt; i);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (max_num[i] == INF) &#123;</div><div class="line">          <span class="built_in">printf</span>(<span class="string">"%d "</span>, free_num);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="built_in">printf</span>(<span class="string">"%d "</span>, max_num[i]);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/禁止字符串/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/禁止字符串/" itemprop="url">禁止字符串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T22:26:29+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给一个长度为$K$的只包含$A,T,C,G$四个字符的字符串$S$，求长度恰好为$N$的不包含字符串$S$的字符串的个数。输出个数对1009取模的结果。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$1\leq K\leq 100,1\leq N\leq10000$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>$dp[i][j]:=$以$S$的最长长度为$j$的前缀为后缀的长度为$i$的字符串的个数。<br>先用$fail[]$数组预处理出$dp$的状态转移表，单后直接$dp$。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_LEN_P = <span class="number">100</span>;  <span class="comment">// 模式串的最大长度</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100</span>;      <span class="comment">// N的最大值</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">10009</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> *AGCT = <span class="string">"AGCT"</span>;  <span class="comment">// 字符集</span></div><div class="line"><span class="keyword">char</span> p[MAX_LEN_P];          <span class="comment">// 模式串</span></div><div class="line"><span class="keyword">int</span> dp[MAX_N][MAX_LEN_P];   <span class="comment">// dp[i][j]:=前i个字符中后缀与p的前缀的最大匹配长度为j的字符串个数</span></div><div class="line"><span class="keyword">int</span> nxt[MAX_LEN_P][<span class="number">4</span>];      <span class="comment">// 状态转移表</span></div><div class="line"><span class="keyword">int</span> fail[MAX_LEN_P];        <span class="comment">// p串的fail指针</span></div><div class="line"><span class="keyword">int</span> N, K;                   <span class="comment">// K为模式串的长度</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetFail</span><span class="params">(<span class="keyword">char</span> p[])</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> k = <span class="number">-1</span>;</div><div class="line">  fail[<span class="number">0</span>] = <span class="number">-1</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; p[i]; ++i) &#123;</div><div class="line">    <span class="keyword">while</span> (k &gt;= <span class="number">0</span> &amp;&amp; p[k + <span class="number">1</span>] != p[i]) k = fail[k];</div><div class="line">    <span class="keyword">if</span> (p[k + <span class="number">1</span>] == p[i]) k++;</div><div class="line">    fail[i] = k;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Solve</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  GetFail(p);</div><div class="line">  <span class="comment">// 预处理状态转移表</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (AGCT[i] == p[<span class="number">0</span>]) nxt[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span> nxt[<span class="number">0</span>][i] = <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; K; ++i) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</div><div class="line">      <span class="keyword">if</span> (AGCT[j] == p[i]) &#123;</div><div class="line">        nxt[i][j] = i + <span class="number">1</span>;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> k;</div><div class="line">        <span class="keyword">for</span> (k = fail[i - <span class="number">1</span>]; k &gt;= <span class="number">0</span> &amp;&amp; p[k + <span class="number">1</span>] != AGCT[j]; k = fail[k]);</div><div class="line">        <span class="keyword">if</span> (p[k + <span class="number">1</span>] == AGCT[j]) ++k;</div><div class="line">        nxt[i][j] = k + <span class="number">1</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 多组小数据时，for循环初始化比memset快</span></div><div class="line">  <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span> dp);</div><div class="line">  dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">    <span class="comment">// for (int j = 0; j &lt; K; ++j) dp[i][j] = 0;</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; K; ++j) &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k) &#123;</div><div class="line">        <span class="keyword">int</span> nt = nxt[j][k];</div><div class="line">        <span class="keyword">if</span> (nt == K) <span class="keyword">continue</span>;</div><div class="line">        dp[i + <span class="number">1</span>][nt] = (dp[i + <span class="number">1</span>][nt] + dp[i][j]) % mod;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; K; ++i) ans = (ans + dp[N][i]) % mod;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="built_in">cin</span> &gt;&gt; N &gt;&gt; K;</div><div class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, p);</div><div class="line">  Solve();</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/16/UVA-10601/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/16/UVA-10601/" itemprop="url">UVA 10601</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-16T20:17:01+08:00">
                2017-07-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给$12$根相同长度的小棍，每个小棍的颜色是$1-6$中的一种。问可以构成多少种不同的正方体。旋转后相同算作同一种。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p><code>null</code></p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>由于颜色个数有限制，所以不能用Polya定理，而要用Burnside引理。</p>
<p>正方体旋转有24种，有以下三类：绕过2个相对的面的中心的轴、绕体对称轴、绕过2个对棱中点的轴。</p>
<p>对每种置换，排列组合以下，计算其不动点的个数。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"></div><div class="line"><span class="keyword">int</span> num[<span class="number">7</span>];</div><div class="line">ll fact[<span class="number">13</span>];</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">calc</span><span class="params">(<span class="keyword">int</span> t)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> s = <span class="number">0</span>;</div><div class="line">  <span class="keyword">int</span> tmp[<span class="number">7</span>];</div><div class="line">  <span class="built_in">memcpy</span>(tmp, num, <span class="keyword">sizeof</span>(num));</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (num[i] % t != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    tmp[i] /= t;</div><div class="line">    s += tmp[i];</div><div class="line">  &#125;</div><div class="line">  ll res = fact[s];</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; ++i) &#123;</div><div class="line">    res /= fact[tmp[i]];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  ll res = <span class="number">0</span>;</div><div class="line">  res += calc(<span class="number">1</span>) + calc(<span class="number">4</span>) * <span class="number">6</span> + calc(<span class="number">2</span>) * <span class="number">3</span> + calc(<span class="number">3</span>) * <span class="number">8</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (num[i] == <span class="number">0</span>) <span class="keyword">continue</span>;</div><div class="line">    num[i]--;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">6</span>; ++j) &#123;</div><div class="line">      <span class="keyword">if</span> (num[j] == <span class="number">0</span>) <span class="keyword">continue</span>;</div><div class="line">      num[j]--;</div><div class="line">      res += <span class="number">6</span> * calc(<span class="number">2</span>);</div><div class="line">      num[j]++;</div><div class="line">    &#125;</div><div class="line">    num[i]++;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res / <span class="number">24</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  fact[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; ++i) &#123;</div><div class="line">    fact[i] = fact[i - <span class="number">1</span>] * i;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">int</span> T; <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</div><div class="line">  <span class="keyword">while</span> (T--) &#123;</div><div class="line">    <span class="built_in">memset</span>(num, <span class="number">0</span>, <span class="keyword">sizeof</span> num);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; ++i) &#123;</div><div class="line">      <span class="keyword">int</span> c; <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c);</div><div class="line">      num[c]++;</div><div class="line">    &#125;</div><div class="line">    solve();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/16/POJ-2888/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/16/POJ-2888/" itemprop="url">POJ 2888</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-16T16:33:38+08:00">
                2017-07-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>$N$个珠子组成的圆环，用$M$种颜色给每个珠子涂色。有$K$个限制条件：$a_i$和$b_i$不能相邻。若两种涂色方案旋转相同，则视为相同方案。问有多少种不同的涂色方案。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$N \leq 10^9 \quad M \leq 10 \quad K \leq \frac{M(M-1)}{2}$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>因为对于涂色有限则，所以不能用Polya定理，要用Burnside引理。</p>
<p>考虑旋转$k(0\leq k \leq N-1)$个珠子的置换$\sigma_k$。它的循环节长度为$gcd(N,k)$，故不动点的个数等价于“序列$a_1,a_2,\cdots,a_{gcd(N,k)},a_1$合法的涂色方案数”。</p>
<p>由于$M$很小，考虑dp。</p>
<p>$f[n][i][j]:=$$i$到$j$的长度为$n$的路径的条数。</p>
<p>转移方程为：$f[n][i][j]=\sum_kf[n-1][i][k] * f[1][k][j]$。这可以看作是矩阵乘法。</p>
<p>边界条件为：$f[1][i][j]$就是图的邻接表。</p>
<p>由于$N$很大，矩阵乘法要用快速幂优化。</p>
<p>所以，$\sigma_k$的不动点个数就是$\sum_i f[gcd(N,k)][i][i]$。</p>
<p>由于$N$很大，直接循环一遍$k$来计算答案会超时。注意到，$gcd(N,k)=d|N$，而$N$的约数$d$的个数很少，我们可以计算有多少$k$使得$gcd(N,k)=d$。设$k=md\quad 0\leq m \leq \frac{N-1}{d} &lt; \frac{N}{d}$，则有$d=gcd(N,k)=g(N,md)=d\times gcd(\frac{N}{d},m)$，所以$gcd(\frac{N}{d},m)=1$。所以，对于某个$d$，$k$的个数=$m$的个数=$\phi(\frac{N}{d})$。</p>
<p>由于$d$的质因数也是$N$的质因数，所以预处理出$N$的质因数，便可在$O(log_2N)$的时间内求出$\phi(d)$。</p>
<p>所以，答案就是：<br>$$<br>\frac{1}{N} \sum_{d|N} \phi(\frac{N}{d})\times \sum_i f[d][i][i]<br>$$<br>复杂度为：$O(\sqrt{N}+d(N)\times (M^3log_2N+log_2N))$</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line">#include &lt;cstdio&gt;</div><div class="line">#include &lt;vector&gt;</div><div class="line">#include &lt;map&gt;</div><div class="line">#include &lt;cstring&gt;</div><div class="line"></div><div class="line">using namespace std;</div><div class="line"></div><div class="line">typedef long long ll;</div><div class="line">//typedef vector&lt;int&gt; vec;</div><div class="line">//typedef vector&lt;vec&gt; mat;</div><div class="line"></div><div class="line">const ll MOD = 9973;</div><div class="line">const int MAX_M = 15;</div><div class="line">const int MAX_NUM = 32005;</div><div class="line"></div><div class="line">int N, M, K;</div><div class="line">bool isPrime[MAX_NUM];</div><div class="line">vector&lt;int&gt; primes;</div><div class="line">int divisors[2005], n1;</div><div class="line">int primeFactors[2005], n2;</div><div class="line"></div><div class="line">struct Mat</div><div class="line">&#123;</div><div class="line">  int n;</div><div class="line">  ll a[MAX_M][MAX_M];</div><div class="line"></div><div class="line">  Mat(int n_):n(n_)&#123;&#125;</div><div class="line"></div><div class="line">  Mat operator * (const Mat &amp;b) const</div><div class="line">  &#123;</div><div class="line">    Mat res(n);</div><div class="line">    for (int i = 0; i &lt; n; ++i) &#123;</div><div class="line">      for (int j = 0; j &lt; n; ++j) &#123;</div><div class="line">        res.a[i][j] = 0;</div><div class="line">        for (int k = 0; k &lt; n; ++k) &#123;</div><div class="line">          res.a[i][j] += a[i][k] * b.a[k][j];</div><div class="line">          //res.a[i][j] = (res.a[i][j] + a[i][k] * b.a[k][j]) % MOD;</div><div class="line">          //垃圾POJ，边算边求余会超时</div><div class="line">        &#125;</div><div class="line">        res.a[i][j] %= MOD;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    return res;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Mat operator ^ (int n_) const</div><div class="line">  &#123;</div><div class="line">    Mat res(n), tmp(n);</div><div class="line">    memset(res.a, 0, sizeof(res.a));</div><div class="line">    for (int i = 0; i &lt; n; ++i) res.a[i][i] = 1;</div><div class="line">    memcpy(tmp.a, a, sizeof a);</div><div class="line">    while (n_) &#123;</div><div class="line">      if (n_ &amp; 1) res = res * tmp;</div><div class="line">      n_ &gt;&gt;= 1;</div><div class="line">      tmp = tmp * tmp;</div><div class="line">    &#125;</div><div class="line">    return res;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">/*</div><div class="line">mat mul(mat &amp;A, mat &amp;B)</div><div class="line">&#123;</div><div class="line">  mat C(A.size(), vec(B[0].size()));</div><div class="line">  for (int i = 0; i &lt; A.size(); ++i) &#123;</div><div class="line">    for (int j = 0; j &lt; B[0].size(); ++j) &#123;</div><div class="line">      for (int k = 0; k &lt; B.size(); ++k) &#123;</div><div class="line">        C[i][j] = (C[i][j] + A[i][k] * B[k][j]);</div><div class="line">      &#125;</div><div class="line">      C[i][j] %= MOD;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  return C;</div><div class="line">&#125;</div><div class="line"></div><div class="line">mat pow(mat A, ll n)</div><div class="line">&#123;</div><div class="line">  mat B(A.size(), vec(A.size()));</div><div class="line">  for (int i = 0; i &lt; A.size(); ++i) &#123;</div><div class="line">    B[i][i] = 1;</div><div class="line">  &#125;</div><div class="line">  for (; n; n &gt;&gt;= 1, A = mul(A, A)) &#123;</div><div class="line">    if (n &amp; 1) B = mul(B, A);</div><div class="line">  &#125;</div><div class="line">  return B;</div><div class="line">&#125;*/</div><div class="line"></div><div class="line">void getDivisors(int n)</div><div class="line">&#123;</div><div class="line">  n1 = 0;</div><div class="line">  for (int i = 1; i * i &lt;= n; ++i) &#123;</div><div class="line">    if (n % i == 0) &#123;</div><div class="line">      divisors[n1++] = i;</div><div class="line">      if (i != n / i) divisors[n1++] = n / i;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void getPrimeFactors(int n)</div><div class="line">&#123;</div><div class="line">  n2 = 0;</div><div class="line">  for (int i = 0; i &lt; primes.size() &amp;&amp; primes[i] * primes[i] &lt;= n; ++i) &#123;</div><div class="line">    if (n % primes[i] == 0) &#123;</div><div class="line">      primeFactors[n2++] = primes[i];</div><div class="line">      while (n % primes[i] == 0) n /= primes[i];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  if (n != 1) primeFactors[n2++] = n;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ll calc(int n, Mat &amp;A)</div><div class="line">&#123;</div><div class="line">  //mat B = pow(A, n);</div><div class="line">  Mat B = A ^ n;</div><div class="line">  ll res = 0;</div><div class="line">  for (int i = 0; i &lt; M; ++i) &#123;</div><div class="line">    res = (res + B.a[i][i]) % MOD;</div><div class="line">  &#125;</div><div class="line">  return res;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ll powMod(ll a, ll n, ll mod)</div><div class="line">&#123;</div><div class="line">  ll res = 1;</div><div class="line">  for (; n; n &gt;&gt;= 1, a = a * a % MOD) &#123;</div><div class="line">    if (n &amp; 1) res = res * a % MOD;</div><div class="line">  &#125;</div><div class="line">  return res;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void sieve(int n)</div><div class="line">&#123;</div><div class="line">  for (int i = 0; i &lt;= n; ++i) isPrime[i] = true;</div><div class="line">  for (int i = 2; i &lt;= n; ++i) &#123;</div><div class="line">    if (isPrime[i]) &#123;</div><div class="line">      primes.push_back(i);</div><div class="line">      for (int j = 2 * i; j &lt;= n; j += i) &#123;</div><div class="line">        isPrime[j] = false;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">  freopen("in.txt", "r", stdin);</div><div class="line">  sieve(32000);</div><div class="line">  int T; scanf("%d", &amp;T);</div><div class="line">  while (T--) &#123;</div><div class="line">    scanf("%d%d%d", &amp;N, &amp;M, &amp;K);</div><div class="line">    //mat A(M, vec(M));</div><div class="line">    Mat A(M);</div><div class="line">    for (int i = 0; i &lt; M; ++i) &#123;</div><div class="line">      for (int j = 0; j &lt; M; ++j) &#123;</div><div class="line">        //A[i][j] = 1;</div><div class="line">        A.a[i][j] = 1;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    for (int i = 0; i &lt; K; ++i) &#123;</div><div class="line">      int aa, bb; scanf("%d%d", &amp;aa, &amp;bb); --aa; --bb;</div><div class="line">      //A[a][b] = A[b][a] = 0;</div><div class="line">      A.a[aa][bb] = A.a[bb][aa] = 0;</div><div class="line">    &#125;</div><div class="line">    getDivisors(N);</div><div class="line">    getPrimeFactors(N);</div><div class="line">    ll ans = 0;</div><div class="line">    for (int i = 0; i &lt; n1; ++i) &#123;</div><div class="line">      int d = divisors[i];</div><div class="line">      int euler = d;</div><div class="line">      for (int j = 0; j &lt; n2; ++j) &#123;</div><div class="line">        int p = primeFactors[j];</div><div class="line">        if (d % p == 0) &#123;</div><div class="line">          euler = euler / p * (p - 1);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      ans += euler * calc(N / d, A);</div><div class="line">      ans %= MOD;</div><div class="line">    &#125;</div><div class="line">    ans = ans * powMod(N % MOD, MOD - 2, MOD) % MOD;</div><div class="line">    printf("%lld\n", ans);</div><div class="line">  &#125;</div><div class="line">  return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>垃圾POJ</li>
<li>矩阵乘法要是用<code>vecctor</code>来实现会超时，边算边求余也会超时。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/14/POJ-1286/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/POJ-1286/" itemprop="url">POJ 1286</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T18:58:52+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>$N$个珠子组成的圆环，用$3$种颜色去给珠子涂色，问有多少种不同的涂色方案。旋转或按对称轴反射之后相同的视作同一种方案。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$0 \leq N \leq 23$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>Polya定理。找出珠子的所有置换。置换有2类，旋转和按对称轴反射。</p>
<ol>
<li>旋转。旋转$k(0\leq k \leq N-1)$个珠子形成的置换写成不相杂轮换的乘积后，不相杂轮换的个数为$gcd(N,k)$个。</li>
<li>按对称轴反射。对$N$分奇偶讨论。$N$为奇数时，有$N$个置换，每个置换的不相杂轮换的个数是$1+\frac{N-1}{2}$。$N$为偶数时，有$\frac{N}{2}$个置换，每个置换的不相杂轮换个数为$1+\frac{N-2}{2}$；还有$\frac{N}{2}$个置换，每个置换的不相杂轮换个数为$2+\frac{N-2}{2}$。</li>
</ol>
<p>由于$N$很小，不用任何优化，直接统计答案即可。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N;</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">fastPow</span><span class="params">(ll a, <span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line">  ll res = <span class="number">1</span>;</div><div class="line">  <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a *= a) &#123;</div><div class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) res *= a;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N), N != <span class="number">-1</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (N == <span class="number">0</span>) &#123;</div><div class="line">      <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</div><div class="line">      <span class="keyword">continue</span>;</div><div class="line">    &#125;</div><div class="line">    ll res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">      res += fastPow(<span class="number">3</span>, __gcd(N, i));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (N &amp; <span class="number">1</span>) &#123;</div><div class="line">      res += N * fastPow(<span class="number">3</span>, (N + <span class="number">1</span>) / <span class="number">2</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      res += N / <span class="number">2</span> * (fastPow(<span class="number">3</span>, N / <span class="number">2</span>) + fastPow(<span class="number">3</span>, (N + <span class="number">2</span>) / <span class="number">2</span>));</div><div class="line">    &#125;</div><div class="line">    res /= <span class="number">2</span> * N;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><code>__gcd()</code>函数在头文件<code>algorithm</code>中。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/HDOJ-1007/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/11/HDOJ-1007/" itemprop="url">HDOJ 1007</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-11T18:36:58+08:00">
                2017-07-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给$N$个点，求最近点对的距离的一半。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$N \leq 100000$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>分治。</p>
<p>先按x坐标分成左右2部分，则最近点对的位置有2种情况：</p>
<ol>
<li>2个点都在左边或者都在右边</li>
<li>1个点在左边另1共个点在右边</li>
</ol>
<p>对于情况1，直接递归计算即可。</p>
<p>对于情况2，由于我们已经递归计算了情况1，我们一定得到了一个初步的最小距离$d$。那么，在情况2中，对于距离大于$d$的点对就不用计算了。只需要计算离分划的$x_m$距离不超过$d$的点。并且，对于确定的$y_p$，为了不重复，只要计算范围在$[y_p-d, y_p]$的点。这里涉及到对y排序，由于是分治，很容易将归并排序加入其中。这样，对于确定的点$(x_p,y_p)$，其中$x_m-d \leq x_p \leq x_m + d$，只要计算一个下图所示的矩形区域。显然，左右的正方形内最多有4个点，所以矩形内最多有6个点。于是，对于每个点，只要计算5个点即可。</p>
<p>分治的层数是$O(log_2N)$，每层操作是$O(N)$的，所以总的复杂度是$O(N\times log_2N)$。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1e5</span> + <span class="number">5</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> INF = <span class="number">2e18</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">double</span>, <span class="keyword">double</span>&gt; P;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N;</div><div class="line">P A[MAX_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_y</span><span class="params">(P a, P b)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">return</span> a.second &lt; b.second;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 传入的a已经按x排序</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">closest_pair</span><span class="params">(P *a, <span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> INF;</div><div class="line">  <span class="keyword">int</span> m = n / <span class="number">2</span>;</div><div class="line">  <span class="keyword">double</span> x = a[m].first;</div><div class="line">  <span class="keyword">double</span> d = min(closest_pair(a, m), closest_pair(a + m, n - m));</div><div class="line">  inplace_merge(a, a + m, a + n, compare_y);</div><div class="line"></div><div class="line">  <span class="built_in">vector</span>&lt;P&gt; b;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(a[i].first - x) &gt;= d) <span class="keyword">continue</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; b.size(); ++j) &#123;</div><div class="line">      <span class="keyword">double</span> dx = a[i].first - b[b.size() - j - <span class="number">1</span>].first;</div><div class="line">      <span class="keyword">double</span> dy = a[i].second - b[b.size() - j - <span class="number">1</span>].second;</div><div class="line">      <span class="keyword">if</span> (dy &gt;= d) <span class="keyword">break</span>;</div><div class="line">      d = min(d, <span class="built_in">sqrt</span>(dx * dx + dy * dy));</div><div class="line">    &#125;</div><div class="line">    b.push_back(a[i]);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> d;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  sort(A, A + N);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%.2f\n"</span>, closest_pair(A, N) / <span class="number">2</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N), N) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</div><div class="line">      <span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>, &amp;A[i].first, &amp;A[i].second);</div><div class="line">    &#125;</div><div class="line">    solve();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/10/POJ-1741/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/10/POJ-1741/" itemprop="url">POJ 1741</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T17:31:46+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给$N$个点的树。问：有多少点对$(v,w)$的最短距离不超过$K$。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$N \leq 10000 \quad \quad K \leq 10000000$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>树上的点分治。</p>
<p>按树的重心分解可以使分解后的子树的最大点数不超过原来点数的一半，所以分治的层数有保障，为$O(log_2N)$。</p>
<p>重心分解之后，符合条件的点对$(v,w)$有三种情况：</p>
<ol>
<li>v和w在同一个子树内。</li>
<li>v和w在不同的子树内。</li>
<li>v和w中一个是重心s，一个不是重心s。</li>
</ol>
<p><img src="http://imglf0.nosdn.127.net/img/b0pmUXJIb2RvdXEraVFLYkQ1MVBGUURBeWo0SnhLTGVTM0Fqd1pPanhFVS9PWW1hdjJXY0FBPT0.png?imageView&amp;thumbnail=1680x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt="img"></p>
<p>其中，情况3可以通过添加一个虚拟的到s的距离为0的点来转化为情况2一起计算。</p>
<p>直接计算情况2不太好算，可以转化为计算：所有满足条件的点对个数-情况1的个数。</p>
<p>为了计算满足条件的点对的个数，每个子问题用了一次排序，由主定理，复杂度为$O(N\times log_2^2N)$</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1e4</span> + <span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span><span class="keyword">int</span> to, cost;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N, K;</div><div class="line"><span class="built_in">vector</span>&lt;Edge&gt; G[MAX_N];</div><div class="line"><span class="keyword">bool</span> centroid[MAX_N];</div><div class="line"><span class="keyword">int</span> subtreeSize[MAX_N];</div><div class="line"><span class="keyword">int</span> ans;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">computeSubtreeSize</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> p)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> c = <span class="number">1</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[v].size(); ++i) &#123;</div><div class="line">    Edge &amp;e = G[v][i];</div><div class="line">    <span class="keyword">if</span> (e.to == p || centroid[e.to]) <span class="keyword">continue</span>;</div><div class="line">    c += computeSubtreeSize(e.to, v);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> subtreeSize[v] = c;</div><div class="line">&#125;</div><div class="line"></div><div class="line">pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; searchCentroid(<span class="keyword">int</span> v, <span class="keyword">int</span> p, <span class="keyword">int</span> t)</div><div class="line">&#123;</div><div class="line">  pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; res = make_pair(INT_MAX, <span class="number">-1</span>);</div><div class="line">  <span class="keyword">int</span> s = <span class="number">1</span>, m = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[v].size(); ++i) &#123;</div><div class="line">    Edge &amp;e = G[v][i];</div><div class="line">    <span class="keyword">if</span> (e.to == p || centroid[e.to]) <span class="keyword">continue</span>;</div><div class="line">    res = min(res, searchCentroid(e.to, v, t));</div><div class="line">    m = max(m, subtreeSize[e.to]);</div><div class="line">    s += subtreeSize[e.to];</div><div class="line">  &#125;</div><div class="line">  m = max(m, t - s);</div><div class="line">  res = min(res, make_pair(m, v));</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getDistince</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> p, <span class="keyword">int</span> d, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ds)</span></span></div><div class="line">&#123;</div><div class="line">  ds.push_back(d);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[v].size(); ++i) &#123;</div><div class="line">    Edge &amp;e = G[v][i];</div><div class="line">    <span class="keyword">if</span> (e.to == p || centroid[e.to]) <span class="keyword">continue</span>;</div><div class="line">    getDistince(e.to, v, d + e.cost, ds);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">countPairs</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;ds)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line">  sort(ds.begin(), ds.end());</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>, r = ds.size() - <span class="number">1</span>; l &lt; r;) &#123;</div><div class="line">    <span class="keyword">if</span> (ds[l] + ds[r] &lt;= K) &#123;</div><div class="line">      res += r - l;</div><div class="line">      ++l;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      --r;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solveSubproblem</span><span class="params">(<span class="keyword">int</span> v)</span></span></div><div class="line">&#123;</div><div class="line">  computeSubtreeSize(v, <span class="number">-1</span>);</div><div class="line">  <span class="keyword">int</span> s = searchCentroid(v, <span class="number">-1</span>, subtreeSize[v]).second;</div><div class="line">  centroid[s] = <span class="literal">true</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[s].size(); ++i) &#123;</div><div class="line">    Edge &amp;e = G[s][i];</div><div class="line">    <span class="keyword">if</span> (centroid[e.to]) <span class="keyword">continue</span>;</div><div class="line">    solveSubproblem(e.to);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ds;</div><div class="line">  ds.push_back(<span class="number">0</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[s].size(); ++i) &#123;</div><div class="line">    Edge &amp;e = G[s][i];</div><div class="line">    <span class="keyword">if</span> (centroid[e.to]) <span class="keyword">continue</span>;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tds;</div><div class="line">    getDistince(e.to, s, e.cost, tds);</div><div class="line">    ans -= countPairs(tds);</div><div class="line">    ds.insert(ds.end(), tds.begin(), tds.end());</div><div class="line">  &#125;</div><div class="line">  ans += countPairs(ds);</div><div class="line">  centroid[s] = <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  ans = <span class="number">0</span>;</div><div class="line">  solveSubproblem(<span class="number">0</span>);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span></span></div><div class="line">&#123;</div><div class="line">  G[a].push_back((Edge)&#123;b, c&#125;);</div><div class="line">  G[b].push_back((Edge)&#123;a, c&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;N, &amp;K), N) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) G[i].clear();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; ++i) &#123;</div><div class="line">      <span class="keyword">int</span> a, b, c; <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;a, &amp;b, &amp;c); --a; --b;</div><div class="line">      addEdge(a, b, c);</div><div class="line">    &#125;</div><div class="line">    solve();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>分治法的思想：分解、解决、合并。在合并的时候，子问题已经解决了。分解一般二分，树上的话重心分解。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/06/BZOJ-2820/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cainiao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cainiao's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/06/BZOJ-2820/" itemprop="url">BZOJ 2820</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-06T21:05:26+08:00">
                2017-07-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>$T$个询问，每个询问求有多少对$(x,y)$使得$gcd(x,y)$是质数，其中$1 \leq x \leq N \quad 1 \leq y \leq M$。</p>
<h1 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h1><p>$T \leq 10^4 \quad N,M \leq 10^7$</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>所求为：<br>$$<br>\sum<em>{p是质数}\sum</em>{x=1}^N \sum_{y=1}^M [gcd(x,y)==p]<br>$$</p>
<p>显然可转化为:<br>$$<br>\sum<em>{p是质数} \sum</em>{x=1}^{N’} \sum_{y=1}^{M’}[gcd(x,y)==1] \quad \quad N’=\frac{N}{p} \quad M’=\frac{M}{P}<br>$$</p>
<p>对内部2个合式进行莫比乌斯反演。</p>
<p>定义：<br>$$<br>g(i):=gcd(x,y)等于i的(x,y)的对数<br>$$</p>
<p>$$<br>f(i):=i|gcd(x,y)的(x,y)的对数<br>$$<br>显然，有：<br>$$<br>f(i)=\lfloor \frac{N’}{i} \rfloor \times \lfloor \frac{M’}{i} \rfloor=\lfloor \frac{N}{p\times i} \rfloor \times \lfloor \frac{M}{p\times i} \rfloor<br>$$</p>
<p>反演一蛤：<br>$$<br>f(i)=\sum<em>{i|d}g(d) \iff g(i)=\sum</em>{i|d} \mu(\frac{d}{i}) f(d)<br>$$</p>
<p>所求为：<br>$$<br>\sum<em>{p是质数}g(1)=\sum</em>{p是质数}\sum<em>{1|d} \mu(d) f(d)=\sum</em>{p是质数}\sum_{1|d} \mu(d) \times\lfloor \frac{N}{p\times d} \rfloor \times \lfloor \frac{M}{p\times d} \rfloor<br>$$<br>若对上式直接枚举p来计算，则一次询问的复杂度是$O(质数p的个数 \times \frac{N}{p}的约数个数)$，复杂度太大。</p>
<p>考虑继续化简。令$p\times d = T$，改变求和次序,则上式可化简为：<br>$$<br>\sum<em>{T=1}^{min(N,M)}\lfloor \frac{N}T{} \rfloor \times \lfloor \frac{M}{T} \rfloor \times \sum</em>{p是质数且p|T}\mu(\frac{T}{p})<br>$$<br>对于$h(T)=\sum_{p是质数且p|T}\mu(\frac{T}{p})$，可以通过埃氏筛法，近乎线性地求出：对于每个素数，把它地对和式的贡献更新到对应的和式中即可。</p>
<p>求出$h(T)$的前缀和之后，便可以分段来加速整个求和过程了。</p>
<p>这样，一次询问的复杂度为$O(N的约数个数 + M的约数个数)$。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NUM = <span class="number">1e7</span> + <span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"></div><div class="line"><span class="keyword">int</span> N, M;</div><div class="line"><span class="keyword">bool</span> isPrime[MAX_NUM];</div><div class="line"><span class="keyword">int</span> mu[MAX_NUM];</div><div class="line"><span class="keyword">int</span> f[MAX_NUM];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getMu</span><span class="params">(<span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">    mu[i] = <span class="number">1</span>;</div><div class="line">    isPrime[i] = <span class="literal">true</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (isPrime[i]) &#123;</div><div class="line">      mu[i] = <span class="number">-1</span>;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> * i; j &lt;= n; j += i) &#123;</div><div class="line">        mu[j] *= <span class="number">-1</span>;</div><div class="line">        <span class="keyword">if</span> ((j / i) % i == <span class="number">0</span>) mu[j] = <span class="number">0</span>;</div><div class="line">        isPrime[j] = <span class="literal">false</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</div><div class="line">    <span class="keyword">if</span> (isPrime[i]) &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= n; j += i) &#123;</div><div class="line">        f[j] += mu[j / i];</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">calc</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">if</span> (n &gt; m) swap(n, m);</div><div class="line">  ll sum = <span class="number">0</span>;</div><div class="line">  <span class="keyword">int</span> last;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i = last + <span class="number">1</span>) &#123;</div><div class="line">    last = min(n / (n / i), m / (m / i));</div><div class="line">    sum += (ll)(n / i) * (m / i) * (f[last] - f[i - <span class="number">1</span>]);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> sum;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  getMu(MAX_NUM - <span class="number">1</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_NUM; ++i) f[i] += f[i - <span class="number">1</span>];</div><div class="line">  <span class="keyword">int</span> T; <span class="built_in">cin</span> &gt;&gt; T;</div><div class="line">  <span class="keyword">while</span> (T--) &#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;N, &amp;M);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, calc(N, M));</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>对于和式的化简，重点在于对求和过程的理解。可以通过改变求和的顺序来化简和式。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://imglf1.nosdn.127.net/img/b0pmUXJIb2RvdXIxY2lHamZ5NnJSNHIySmtUZHlGSjBuREhDaFFMMjBxaExUc1dHdkdrdmxBPT0.jpg?imageView&thumbnail=500x0&quality=96&stripmeta=0&type=jpg"
               alt="Cainiao" />
          <p class="site-author-name" itemprop="name">Cainiao</p>
           
              <p class="site-description motion-element" itemprop="description">悟已往之不谏，知来者之可追。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cainiao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
